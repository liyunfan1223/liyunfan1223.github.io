<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.2 -->
    <script>
        window.materialVersion = "1.5.2"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">



    <link rel="dns-prefetch" href="https://busuanzi.ibruce.info"/>












    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            计网lab-基于udp实现可靠传输协议(ABP/GBN) | 
        
        Moonglade
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon_io_c/favicon-32x32.png">
    <link rel="icon" href="/img/favicon_io_c/android-chrome-512x512.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="准备Message和Packet类定义分别作为应用层和传输层的数据包
其中Packet类的generateChecksum()方法根据报文数据生成校验和，selfcheck()方法根据报文数据和校验和检查数据是否损坏">
    <meta name="keywords" content=",lab,计算机网络">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/tranquil-heart.min.css?ul3p9I9MsbOxK0L+BHzDDg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body {
        background-color: ;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text {
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Moonglade">
    <meta name="msapplication-starturl" content="https://moonglade.top/2021/06/03/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/%E8%AE%A1%E7%BD%91lab-%E5%9F%BA%E4%BA%8Eudp%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE-ABP-GBN/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Moonglade">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon_io_c/apple-touch-icon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://moonglade.top/2021/06/03/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/%E8%AE%A1%E7%BD%91lab-%E5%9F%BA%E4%BA%8Eudp%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE-ABP-GBN/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="计网lab-基于udp实现可靠传输协议(ABP/GBN) | Moonglade">
    <meta property="og:image" content="/img/favicon_io_c/android-chrome-512x512.png">
    <meta property="og:description" content="准备Message和Packet类定义分别作为应用层和传输层的数据包
其中Packet类的generateChecksum()方法根据报文数据生成校验和，selfcheck()方法根据报文数据和校验和检查数据是否损坏">
    <meta property="og:article:tag" content="lab"> <meta property="og:article:tag" content="计算机网络"> 

    
        <meta property="article:published_time" content="Thu Jun 03 2021 19:41:39 GMT+0800">
        <meta property="article:modified_time" content="Sat Feb 26 2022 18:21:01 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="https://moonglade.top/2021/06/03/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/%E8%AE%A1%E7%BD%91lab-%E5%9F%BA%E4%BA%8Eudp%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE-ABP-GBN/index.html" />
    

    <!-- Structured-data for SEO -->
    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

<meta name="generator" content="Hexo 6.0.0"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%87%86%E5%A4%87"><span class="post-toc-number">1.</span> <span class="post-toc-text">准备</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Message%E5%92%8CPacket%E7%B1%BB%E5%AE%9A%E4%B9%89"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Message和Packet类定义</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E6%A8%A1%E5%9D%97Serialization"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">序列化模块Serialization</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">超时时间计算方法</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E6%AF%94%E7%89%B9%E4%BA%A4%E6%9B%BF%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0"><span class="post-toc-number">2.</span> <span class="post-toc-text">比特交替协议实现</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8F%91%E9%80%81%E6%96%B9"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">发送方</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%8E%A5%E6%94%B6%E6%96%B9"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">接收方</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#GBN%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0"><span class="post-toc-number">3.</span> <span class="post-toc-text">GBN协议实现</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8F%91%E9%80%81%E6%96%B9-1"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">发送方</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%8E%A5%E6%94%B6%E6%96%B9-1"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">接收方</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E7%BB%93%E6%9E%9C%E5%92%8C%E6%B5%8B%E8%AF%95"><span class="post-toc-number">4.</span> <span class="post-toc-text">结果和测试</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E6%80%BB%E7%BB%93"><span class="post-toc-number">5.</span> <span class="post-toc-text">总结</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                计网lab-基于udp实现可靠传输协议(ABP/GBN)
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/favicon_io/android-chrome-512x512.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>MorphLing</strong>
        <span>6月 03, 2021</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-none-link" href="/tags/lab/" rel="tag">lab</a></li><li class="mdl-menu__item"><a class="post_tag-none-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    
        
            <!-- Busuanzi Views -->
            <a class="post_share-link" href="#">
                <li class="mdl-menu__item">
                    <span id="busuanzi_container_page_pv">
                        <span id="busuanzi_value_page_pv"></span>&nbsp;浏览量
                    </span>
                </li>
            </a>
        
    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=计网lab-基于udp实现可靠传输协议(ABP/GBN)&url=https://moonglade.top/2021/06/03/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/%E8%AE%A1%E7%BD%91lab-%E5%9F%BA%E4%BA%8Eudp%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE-ABP-GBN/index.html&pic=https://moonglade.top/img/favicon_io_c/favicon-32x32.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=计网lab-基于udp实现可靠传输协议(ABP/GBN)&url=https://moonglade.top/2021/06/03/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/%E8%AE%A1%E7%BD%91lab-%E5%9F%BA%E4%BA%8Eudp%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE-ABP-GBN/index.html&via=MorphLing" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://moonglade.top/2021/06/03/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/%E8%AE%A1%E7%BD%91lab-%E5%9F%BA%E4%BA%8Eudp%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE-ABP-GBN/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=https://moonglade.top/2021/06/03/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/%E8%AE%A1%E7%BD%91lab-%E5%9F%BA%E4%BA%8Eudp%E5%AE%9E%E7%8E%B0%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE-ABP-GBN/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><h2 id="Message和Packet类定义"><a href="#Message和Packet类定义" class="headerlink" title="Message和Packet类定义"></a>Message和Packet类定义</h2><p>分别作为应用层和传输层的数据包</p>
<p>其中Packet类的generateChecksum()方法根据报文数据生成校验和，selfcheck()方法根据报文数据和校验和检查数据是否损坏</p>
<span id="more"></span>
<pre><code class="lang-java">public class Message &#123;
  public char[] data = new char[20];
  public Message(char[] str) &#123;
     for (int i = 0; i &lt; 20; i++) data[i] = str[i];
  &#125;
  public Message(Packet pkt) &#123;
     for (int i = 0; i &lt; 20; i++) data[i] = pkt.payload[i];
  &#125;
&#125;
package MyClass;
import java.io.Serializable;

public class Packet implements Serializable &#123;
  private int seqnum;
  private int acknum;
  private int checksum;
  public char[] payload = new char[20];
  public void setSeq(int _seqnum) &#123; seqnum = _seqnum; &#125;
  public void setAck(int _acknum) &#123; acknum = _acknum; &#125;
  public int getSeq() &#123; return seqnum; &#125;
  public int getAck() &#123; return acknum; &#125;
  public void generateChecksum() &#123;
​    checksum += seqnum;
​    checksum += acknum;
​    for (int i = 0; i &lt; 20; i++) checksum += payload[i];
​    checksum = ~checksum;
  &#125;
  public boolean selfcheck() &#123;
​    int value = checksum;
​    value += seqnum;
​    value += acknum;
​    for (int i = 0; i &lt; 20; i++) value +=payload[i];
​    if (value != -1) return false;
​    return true;
  &#125;
  public Packet()&#123;&#125;
  public Packet(Message msg) &#123;
​    for (int i = 0; i &lt; 20; i++) &#123;
​      payload[i] = msg.data[i];
​    &#125;
  &#125;
&#125;
</code></pre>
<h2 id="序列化模块Serialization"><a href="#序列化模块Serialization" class="headerlink" title="序列化模块Serialization"></a>序列化模块Serialization</h2><p>由于udp只能传输字节数组，需要定义序列化模块实现class与字节数组的相互转换</p>
<pre><code class="lang-java">public class Message &#123;
    public char[] data = new char[20];
    public Message(char[] str) &#123;
        for (int i = 0; i &lt; 20; i++) data[i] = str[i];
    &#125;
    public Message(Packet pkt) &#123;
        for (int i = 0; i &lt; 20; i++) data[i] = pkt.payload[i];
    &#125;
&#125;
package MyClass;

import java.io.Serializable;

public class Packet implements Serializable &#123;
    private int seqnum;
    private int acknum;
    private int checksum;
    public char[] payload = new char[20];
    public void setSeq(int _seqnum) &#123; seqnum = _seqnum; &#125;
    public void setAck(int _acknum) &#123; acknum = _acknum; &#125;
    public int getSeq() &#123; return seqnum; &#125;
    public int getAck() &#123; return acknum; &#125;
    public void generateChecksum() &#123;
        checksum += seqnum;
        checksum += acknum;
        for (int i = 0; i &lt; 20; i++) checksum += payload[i];
        checksum = ~checksum;
    &#125;
    public boolean selfcheck() &#123;
        int value = checksum;
        value += seqnum;
        value += acknum;
        for (int i = 0; i &lt; 20; i++) value +=payload[i];
        if (value != -1) return false;
        return true;
    &#125;
    public Packet()&#123;&#125;
    public Packet(Message msg) &#123;
        for (int i = 0; i &lt; 20; i++) &#123;
            payload[i] = msg.data[i];
        &#125;
    &#125;
&#125;
</code></pre>
<h2 id="超时时间计算方法"><a href="#超时时间计算方法" class="headerlink" title="超时时间计算方法"></a>超时时间计算方法</h2><p>参考书3.5.3</p>
<p><img src="https://morphling-picgo.oss-cn-shanghai.aliyuncs.com/20210603195457.jpg" alt="img"></p>
<p><img src="https://morphling-picgo.oss-cn-shanghai.aliyuncs.com/20210603195502.jpg" alt="img"></p>
<p><img src="https://morphling-picgo.oss-cn-shanghai.aliyuncs.com/20210603195505.jpg" alt="img"></p>
<p>Alpha,beta分别取0.125和0.25</p>
<pre><code class="lang-java">SampleRTT = receiveTime - sendTime;
EstimatedRTT = (long)(0.875 * EstimatedRTT + 0.125 * SampleRTT);
DevRTT = (long)(0.75 * DevRTT + 0.25 * Math.abs(SampleRTT - EstimatedRTT));
TimeoutInterval = EstimatedRTT + 4 * DevRTT;
</code></pre>
<p>将TImeoutInterval初始化为1000ms，EstimatedRTT和SampleRTT初始化为500ms</p>
<h1 id="比特交替协议实现"><a href="#比特交替协议实现" class="headerlink" title="比特交替协议实现"></a>比特交替协议实现</h1><p>通过变量记录当前0/1状态，通过线程交互实现停等和超时重发。</p>
<h2 id="发送方"><a href="#发送方" class="headerlink" title="发送方"></a>发送方</h2><p><img src="https://morphling-picgo.oss-cn-shanghai.aliyuncs.com/20210603195512.jpg" alt="img"></p>
<p>参考课本上rdt发送方的FSM进行设计。整体思路上使用三个线程分别处理上层调用、接收ACK响应包和超时重发。调用线程1将Message转化为Packet并将数据包通过A_output()发送给服务器端后，调用计时线程3并通过wait()进入等待状态，接收线程2收到响应包后，判断是否发送成功，若成功则中止计时线程3并唤醒线程1，否则线程3计时结束后通过toLayer3()重发数据包，再由线程2判断是否发送成功，直到接收到响应成功。</p>
<p>通过变量seqNum判断当前处于FSM的哪种状态，每接收到一个成功发送响应，seqNum变量的值将0/1交替。使用对象锁的方式实现线程交互（等待和唤醒）。</p>
<pre><code class="lang-java">package rdt;

import java.io.IOException;
import java.net.DatagramSocket;
import java.net.DatagramPacket;
import java.net.InetAddress;
import java.util.concurrent.TimeUnit;

import MyClass.Message;
import MyClass.Packet;
import MyClass.Serialization;

public class Client implements Runnable &#123;
    class Timer implements Runnable &#123;
        private long timeout;
        Timer(long _timeout) &#123; timeout = _timeout; &#125;
        void setTimeout() &#123;&#125;
        public void run () &#123;
            try &#123;
                TimeUnit.MILLISECONDS.sleep(timeout);
                A_timerinterrupt();
            &#125; catch (InterruptedException e) &#123;
            &#125; catch (IOException e) &#123;
                e.printStackTrace();
            &#125; catch (ClassNotFoundException e) &#123;
                e.printStackTrace();
            &#125;
        &#125;
    &#125;
    void A_timerinterrupt() throws InterruptedException, ClassNotFoundException, IOException&#123;
        System.out.println(&quot;前一个Packet发送超时，开始重发。&quot;);
        TimeoutInterval *= 2;
        startTimer(TimeoutInterval);
        toLayer3(lastpkt);
    &#125;
    void startTimer(long increment) &#123;
        System.out.println(&quot;计时器启动: &quot; + increment + &quot;ms后重新发送。&quot;);
        if (timer != null &amp;&amp; !timer.isInterrupted()) stopTimer();
        timer = new Thread(new Timer(increment));
        timer.start();
    &#125;
    void stopTimer() &#123;
        System.out.println(&quot;计时器中止。&quot;);
        timer.interrupt();
    &#125;
    class Receiver implements Runnable &#123;
        public void run() &#123;
            try &#123;
                DatagramSocket datagramSocket = new DatagramSocket(11000);
                int cnt = 0;
                while (cnt &lt; MAXSEQ) &#123;
                    byte[] buf = new byte[1024];
                    DatagramPacket dataPacket = new DatagramPacket(buf, buf.length);
                    datagramSocket.receive(dataPacket);
                    Packet receivePack = Serialization.BytesToPacket(dataPacket.getData());
                    if (receivePack.selfcheck() &amp;&amp; receivePack.getAck() == seqNum) &#123;
                        cnt++;
                        int ackNum = receivePack.getAck();
                        long receiveTime = System.currentTimeMillis();
                        SampleRTT = receiveTime - sendTime;
                        EstimatedRTT = (long)(0.875 * EstimatedRTT + 0.125 * SampleRTT);
                        DevRTT = (long)(0.75 * DevRTT + 0.25 * Math.abs(SampleRTT - EstimatedRTT));
                        TimeoutInterval = EstimatedRTT + 4 * DevRTT;
                        stopTimer();
                        synchronized (obj) &#123;
                            obj.notify();
                        &#125;
                    &#125; else &#123;
                        System.out.println(&quot;响应包损坏，或前一次发送未被收到。&quot;);
                    &#125;
                &#125;
            &#125; catch (IOException e) &#123;
                e.printStackTrace();
            &#125; catch (ClassNotFoundException e) &#123;
                e.printStackTrace();
            &#125;
        &#125;
    &#125;
    static final Object obj = new Object();
    static Thread timer;
    static Thread thread = new Thread(new Client());
    Packet lastpkt;
    int MAXSEQ;
    int targetPort;
    int seqNum;
    long sendTime;
    long EstimatedRTT, SampleRTT, DevRTT, TimeoutInterval;
    void A_init() throws IOException &#123;
        MAXSEQ = 50;
        seqNum = 0;
        TimeoutInterval = 1000;
        EstimatedRTT = SampleRTT = 500;
        DevRTT = 0;
        targetPort = 12000;
    &#125;

    void toLayer3(Packet pkt) throws IOException &#123;
        DatagramSocket datagramSocket = new DatagramSocket();
        byte[] sendBytes = Serialization.PacketToBytes(pkt);
        DatagramPacket datagramPacket = new DatagramPacket(
                sendBytes,
                sendBytes.length,
                InetAddress.getLocalHost(),
                targetPort
        );
        try &#123;
            lastpkt = pkt;
            sendTime = System.currentTimeMillis();
            datagramSocket.send(datagramPacket);
            System.out.printf(&quot;Packet发送成功，时间已记录。序列号：%d\n&quot;, pkt.getSeq());
            // System.out.println(pkt.getSeq());
        &#125; catch (IOException e) &#123;
            System.out.println(&quot;Packet发送失败。&quot;);
        &#125;
    &#125;
    void A_output(Message msg) throws IOException, ClassNotFoundException, InterruptedException &#123;
        Packet pkt = new Packet(msg);
        pkt.setSeq(seqNum);
        pkt.generateChecksum();
        startTimer(TimeoutInterval);
        toLayer3(pkt);
    &#125;
    public void run() &#123;
        Thread receiver = new Thread(new Receiver());
        receiver.start();
        try &#123;
            A_init();
            for (int i = 1; i &lt;= MAXSEQ; i++) &#123;
                char[] data = new char[20];
                for (int j = 0; j &lt; 20; j++) data[j] = (char) (&#39;a&#39; + (i - 1) % 26);
                Message msg = new Message(data);
                A_output(msg);
                synchronized (obj) &#123;
                    obj.wait();
                &#125;
                seqNum ^= 1;
            &#125;
        &#125; catch (IOException e) &#123;
            e.printStackTrace();
        &#125; catch (ClassNotFoundException e) &#123;
            e.printStackTrace();
        &#125; catch (InterruptedException e) &#123;
            e.printStackTrace();
        &#125;
    &#125;
    public static void main(String[] args)&#123;
        thread.start();
    &#125;
&#125;
</code></pre>
<h2 id="接收方"><a href="#接收方" class="headerlink" title="接收方"></a>接收方</h2><p><img src="https://morphling-picgo.oss-cn-shanghai.aliyuncs.com/20210603195519.png" alt="img"></p>
<p>同样通过seqNum判断当前FSM状态。发送响应包时，通过发送与当前状态相反的状态值表示数据包发送失败。通过参数lossRate和simulatedDelay模拟真实网络中的丢包和延迟情况。</p>
<p>lossRate = 0.2;</p>
<p>simulatedDelay = 200;</p>
<p>当发送相应包时，通过Math.random()生成一个0~1的随机数，若Math.random()&lt;lossRate则视作响应包发送失败，不进行发送。每次发送响应包前随机等待利用TimeUnit.MILLISECONDS.sleep 随机等待Math.random() * simulatedDelay毫秒，模拟网络延迟。</p>
<p>由于阻塞情况只有一种（即等待用户端发送数据包），所以单线程即可实现。</p>
<pre><code class="lang-java">package rdt;


import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.util.concurrent.TimeUnit;

import MyClass.Message;
import MyClass.Packet;
import MyClass.Serialization;


public class Server &#123;
    DatagramSocket datagramSocket;
    byte[] buf;
    int seqNum;
    int targetPort;
    double lossRate;
    long simulatedDelay;
    void B_init() throws IOException &#123;
        datagramSocket = new DatagramSocket(12000);
        lossRate = 0.2;
        simulatedDelay = 200;
        buf = new byte[1024];
        seqNum = 0;
        targetPort = 11000;
    &#125;
    void tolayer5(Packet pkt) &#123;
        Message msg = new Message(pkt);
        System.out.print(&quot;信息接收成功。&quot;);
        msg.show();
    &#125;
    void B_input(Packet pkt, DatagramPacket datagramPacket) throws IOException&#123;
        System.out.println(seqNum + &quot; &quot; + pkt.getSeq() + &quot; &quot; + pkt.selfcheck());
        if (!pkt.selfcheck() || pkt.getSeq() != seqNum) &#123;
            System.out.println(&quot;Packet损坏或重复。&quot;);

            if (Math.random() &gt; lossRate) &#123;
                System.out.println(&quot;损坏响应已发送。&quot;);
                Packet responsePacket = new Packet();
                responsePacket.setAck(seqNum ^ 1);
                responsePacket.generateChecksum();
                byte[] sendData = Serialization.PacketToBytes(responsePacket);
                DatagramPacket sendPacket = new DatagramPacket(
                        sendData,
                        sendData.length,
                        datagramPacket.getAddress(),
                        targetPort
                );
                datagramSocket.send(sendPacket);
            &#125; else &#123;
                System.out.println(&quot;响应消息发送失败。&quot;);
            &#125;
        &#125; else &#123;
            tolayer5(pkt);
            if (Math.random() &gt; lossRate) &#123;
                Packet responsePacket = new Packet();
                responsePacket.setAck(seqNum);
                responsePacket.generateChecksum();
                byte[] sendData = Serialization.PacketToBytes(responsePacket);
                DatagramPacket sendPacket = new DatagramPacket(
                        sendData,
                        sendData.length,
                        datagramPacket.getAddress(),
                        targetPort
                );
                datagramSocket.send(sendPacket);
            &#125; else &#123;
                System.out.println(&quot;响应消息发送失败。&quot;);
            &#125;
            seqNum ^= 1;
        &#125;
    &#125;
    void run() throws IOException, ClassNotFoundException, InterruptedException&#123;
        B_init();
        while(true) &#123;
            DatagramPacket datagramPacket = new DatagramPacket(buf, buf.length);
            datagramSocket.receive(datagramPacket);
            Packet pkt = Serialization.BytesToPacket(buf);
            TimeUnit.MILLISECONDS.sleep((long)(Math.random() * simulatedDelay));
            B_input(pkt, datagramPacket);
        &#125;
    &#125;
    public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException&#123;
        Server server = new Server();
        server.run();
    &#125;
&#125;
</code></pre>
<h1 id="GBN协议实现"><a href="#GBN协议实现" class="headerlink" title="GBN协议实现"></a>GBN协议实现</h1><p>实现方式与比特交替协议类似，区别在于GBN协议不是严格的停等协议，可能会出现连续发送多个包后再连续接收多个响应包的情况，数据包发送和接收情况变得更加复杂。因此没有采用阻塞的方式控制线程，而是给上层调用加了一定的间隔（300ms），并且当上层调用时滑动窗口大小以达到上限时，将丢弃一些上层调用。同时为了简化问题，序列号没有采用循环的方式，而是由1开始编号至n。</p>
<h2 id="发送方-1"><a href="#发送方-1" class="headerlink" title="发送方"></a>发送方</h2><p><img src="https://morphling-picgo.oss-cn-shanghai.aliyuncs.com/20210603195524.jpg" alt="img"></p>
<p>设置windowSize=8作为窗口最大值，通过base和nextSeqNum控制滑动窗口的大小和位置。收到上层调用时，先判断窗口大小是否已经达到上限，若还没有达到上限则发送数据包并将窗口扩大一位。由于响应包接收情况可能乱序，需要用数组的方式记录每个数据包发送的时间来计算RTT。触发超时重传时，需要循环重发base~nextSeqNum-1的所有数据包。其余类似比特交替协议。</p>
<pre><code class="lang-java">package gbn;

import java.io.IOException;
import java.net.DatagramSocket;
import java.net.DatagramPacket;
import java.net.InetAddress;
import java.util.concurrent.TimeUnit;

import MyClass.Message;
import MyClass.Packet;
import MyClass.Serialization;


public class Client implements Runnable &#123;
    class Timer implements Runnable &#123;
        private long timeout;
        Timer(long _timeout) &#123; timeout = _timeout; &#125;
        public void run () &#123;
            try &#123;
                TimeUnit.MILLISECONDS.sleep(timeout);
                A_timerinterrupt();
            &#125; catch (InterruptedException e) &#123;
            &#125; catch (IOException e) &#123;
                e.printStackTrace();
            &#125; catch (ClassNotFoundException e) &#123;
                e.printStackTrace();
            &#125;
        &#125;
    &#125;
    void A_timerinterrupt() throws InterruptedException, ClassNotFoundException, IOException&#123;
        System.out.println(&quot;计时器时限到，开始重发。&quot;);
        TimeoutInterval *= 2;
        startTimer(TimeoutInterval);
        for (int i = base; i &lt; nextSeqNum; i++) &#123;
            char[] data = new char[20];
            for (int j = 0; j &lt; 20; j++) data[j] = (char) (&#39;a&#39; + i % 26);
            Message msg = new Message(data);
            Packet pkt = new Packet(msg);
            pkt.setSeq(i);
            pkt.generateChecksum();
            toLayer3(pkt);
        &#125;
    &#125;
    void startTimer(long increment) &#123;
        System.out.println(&quot;计时器启动: &quot; + increment + &quot;ms后重新发送。&quot;);
        if (timer != null &amp;&amp; !timer.isInterrupted()) stopTimer();
        timer = new Thread(new Timer(increment));
        timer.start();
    &#125;
    void stopTimer() &#123;
        System.out.println(&quot;计时器中止。&quot;);
        timer.interrupt();
    &#125;
    class Receiver implements Runnable &#123;
        public void run() &#123;
            try &#123;
                DatagramSocket datagramSocket = new DatagramSocket(11000);
                while (base != MAXSEQ + 1) &#123;
                    byte[] buf = new byte[1024];
                    DatagramPacket dataPacket = new DatagramPacket(buf, buf.length);
                    datagramSocket.receive(dataPacket);
                    Packet receivePack = Serialization.BytesToPacket(dataPacket.getData());
                    if (receivePack.selfcheck()) &#123;
                        int ackNum = receivePack.getAck();
                        base = Math.max(base, ackNum);
                        long receiveTime = System.currentTimeMillis();
                        SampleRTT = receiveTime - sendTime[ackNum - 1];
                        EstimatedRTT = (long)(0.875 * EstimatedRTT + 0.125 * SampleRTT);
                        DevRTT = (long)(0.75 * DevRTT + 0.25 * Math.abs(SampleRTT - EstimatedRTT));
                        TimeoutInterval = EstimatedRTT + 4 * DevRTT;
                        // System.out.println(&quot;TimeoutInterval被修改为&quot; + TimeoutInterval + &quot; ackNum为&quot; + ackNum);
                        stopTimer();
                        if (base != nextSeqNum) startTimer(TimeoutInterval);
                    &#125; else &#123;
                        System.out.println(&quot;响应包损坏。&quot;);
                    &#125;
                &#125;
            &#125; catch (IOException e) &#123;
                e.printStackTrace();
            &#125; catch (ClassNotFoundException e) &#123;
                e.printStackTrace();
            &#125;
        &#125;
    &#125;
    static Thread timer;
    static Thread thread = new Thread(new Client());
    int MAXSEQ;
    int targetPort;
    int windowSize;
    int base;
    int nextSeqNum;
    static long sendTime[];
    long EstimatedRTT, SampleRTT, DevRTT, TimeoutInterval;
    void A_init() throws IOException &#123;
        MAXSEQ = 50;
        base = nextSeqNum = 1;
        windowSize = 8;
        TimeoutInterval = 1000;
        EstimatedRTT = SampleRTT = 500;
        DevRTT = 0;
        targetPort = 12000;
        sendTime = new long[MAXSEQ + 1];
    &#125;

    void toLayer3(Packet pkt) throws IOException &#123;
        DatagramSocket datagramSocket = new DatagramSocket();
        byte[] sendBytes = Serialization.PacketToBytes(pkt);
        DatagramPacket datagramPacket = new DatagramPacket(
                sendBytes,
                sendBytes.length,
                InetAddress.getLocalHost(),
                targetPort
        );
        try &#123;

            sendTime[pkt.getSeq()] = System.currentTimeMillis();
            datagramSocket.send(datagramPacket);
            System.out.printf(&quot;第 %d 个Packet发送成功，时间已记录。\n&quot;, pkt.getSeq());
        &#125; catch (IOException e) &#123;
            System.out.println(&quot;Packet发送失败。&quot;);
        &#125;
    &#125;
   void A_output(Message msg) throws IOException, ClassNotFoundException, InterruptedException &#123;
        if (nextSeqNum &lt; base + windowSize) &#123;
            Packet pkt = new Packet(msg);
            pkt.setSeq(nextSeqNum);
            pkt.generateChecksum();

            toLayer3(pkt);
            if (base == nextSeqNum) startTimer(TimeoutInterval);
            nextSeqNum++;
        &#125;
    &#125;
    public void run() &#123;
        Thread receiver = new Thread(new Receiver());
        receiver.start();
        try &#123;
            A_init();
            for (int i = 1; i &lt;= MAXSEQ; i++) &#123;
                char[] data = new char[20];
                for (int j = 0; j &lt; 20; j++) data[j] = (char) (&#39;a&#39; + (i - 1) % 26);
                Message msg = new Message(data);
                A_output(msg);
                TimeUnit.MILLISECONDS.sleep(200);
            &#125;
        &#125; catch (IOException e) &#123;
            e.printStackTrace();
        &#125; catch (ClassNotFoundException e) &#123;
            e.printStackTrace();
        &#125; catch (InterruptedException e) &#123;
            e.printStackTrace();
        &#125;
    &#125;
    public static void main(String[] args)&#123;
        thread.start();
    &#125;
&#125;
</code></pre>
<h2 id="接收方-1"><a href="#接收方-1" class="headerlink" title="接收方"></a>接收方</h2><p><img src="https://morphling-picgo.oss-cn-shanghai.aliyuncs.com/20210603195530.jpg" alt="img"></p>
<p>和比特交替协议的区别在于，收到的序列号seqnum和响应包发送的acknum不再是0/1交替，而是每次自增一。GBN接收方采取累计接收方法，如果接收到的数据包有误，返回的acknum为当前已接收的最大的序列号，表示该序列号以及所有该序列号以前的包都已成功接收。</p>
<pre><code class="lang-java">package gbn;

import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.util.concurrent.TimeUnit;

import MyClass.Message;
import MyClass.Packet;
import MyClass.Serialization;

public class Server &#123;
    DatagramSocket datagramSocket;
    byte[] buf;
    int seqNum;
    int windowSize;
    int targetPort;
    double lossRate;
    long simulatedDelay;
    void B_init() throws IOException &#123;
        windowSize = 8;
        datagramSocket = new DatagramSocket(12000);
        lossRate = 0.2;
        simulatedDelay = 200;
        buf = new byte[1024];
        seqNum = 1;
        targetPort = 11000;
    &#125;
    void tolayer5(Packet pkt) &#123;
        Message msg = new Message(pkt);
        System.out.print(&quot;信息接收成功。&quot;);
        msg.show();
    &#125;
    void B_input(Packet pkt, DatagramPacket datagramPacket) throws IOException&#123;
        if (!pkt.selfcheck() || pkt.getSeq() != seqNum) &#123;
            System.out.println(&quot;Packet损坏或重复。&quot;);
            // System.out.println(seqNum + &quot; &quot; + pkt.getSeq() + &quot; &quot; + pkt.selfcheck());
            if (Math.random() &gt; lossRate) &#123;
                System.out.println(&quot;损坏响应已发送。&quot;);
                Packet responsePacket = new Packet();
                responsePacket.setAck(seqNum);
                responsePacket.generateChecksum();
                byte[] sendData = Serialization.PacketToBytes(responsePacket);
                DatagramPacket sendPacket = new DatagramPacket(
                        sendData,
                        sendData.length,
                        datagramPacket.getAddress(),
                        targetPort
                );
                datagramSocket.send(sendPacket);
            &#125; else &#123;
                System.out.println(&quot;响应消息发送失败。&quot;);
            &#125;
        &#125; else &#123;
            tolayer5(pkt);
            seqNum++;
            if (Math.random() &gt; lossRate) &#123;
                Packet responsePacket = new Packet();
                responsePacket.setAck(seqNum);
                responsePacket.generateChecksum();
                byte[] sendData = Serialization.PacketToBytes(responsePacket);
                // 好坑
                DatagramPacket sendPacket = new DatagramPacket(
                        sendData,
                        sendData.length,
                        datagramPacket.getAddress(),
                        targetPort
                );
                datagramSocket.send(sendPacket);
            &#125; else &#123;
                System.out.println(&quot;响应消息发送失败。&quot;);
            &#125;
        &#125;
    &#125;
    void run() throws IOException, ClassNotFoundException, InterruptedException&#123;
        B_init();
        while(true) &#123;
            DatagramPacket datagramPacket = new DatagramPacket(buf, buf.length);
            datagramSocket.receive(datagramPacket);
            Packet pkt = Serialization.BytesToPacket(buf);
            TimeUnit.MILLISECONDS.sleep((long)(Math.random() * simulatedDelay));
            B_input(pkt, datagramPacket);
        &#125;
    &#125;
    public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException&#123;
        Server server = new Server();
        server.run();
    &#125;
&#125;
</code></pre>
<h1 id="结果和测试"><a href="#结果和测试" class="headerlink" title="结果和测试"></a>结果和测试</h1><p>可以通过参数设置响应包发送失败的概率，当丢包概率为0时，所有消息被正确接收，不会触发超时重发。（图为比特交替协议）：</p>
<p><img src="https://morphling-picgo.oss-cn-shanghai.aliyuncs.com/20210603195536.png" alt="img"></p>
<p><img src="https://morphling-picgo.oss-cn-shanghai.aliyuncs.com/20210603200904.png" alt="img"></p>
<p>将丢包概率提高到30%后，服务器端频繁出现响应包发送失败的情况，客户端同时触发超时重传。（图为GBN协议）：</p>
<p><img src="https://morphling-picgo.oss-cn-shanghai.aliyuncs.com/20210603195544.png" alt="img"></p>
<p><img src="https://morphling-picgo.oss-cn-shanghai.aliyuncs.com/20210603195744.png" alt="img"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>由于代码量较大，本次实验过程中对实验所需要的常用功能进行了模块化（如序列化模块实现class与字符数组相互转化、Packet校验和生成和检验等），同时加深了对java语言和多线程编程的运用和理解。</p>
<p>实验过程中调试解决了一些问题，如：</p>
<p>多线程编程中udp数据包发送线程和接收线程的端口号不同，这意味着服务器端不能通过receivePacket.getPort()来获取端口并作为响应包的发送端口，因为通过这方法获得的端口是发送线程而不是接收线程的。因此需要提前指定客户端的socket端口，如11000。</p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 Gitalk -->
<div id="gitalk-comment">
    <!-- Gitalk 评论框 -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script> 
<script>
    var gitalk = new Gitalk({
            clientID: 'b8ab854d61e4537d8b06',
            clientSecret: '2557531f91b562289cfc3025675934139fc97766',
            repo: 'gitalk-repo',
            owner: 'liyunfan1223',
            admin: ['liyunfan1223'],
            id: md5(location.pathname),
            // facebook-like distraction free mode
            distractionFreeMode: false
        })
   gitalk.render('gitalk-container')
</script>
</div>
<style>
    #gitalk-comment {
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2021/06/04/%E6%9D%82%E9%A1%B9/matplotlib%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%BB%93/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2021/06/03/%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B/ECNU-XCPC-2021-Selection-Round-3/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/favicon_io/android-chrome-512x512.png" alt="MorphLing's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        liyunfan1223@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2022/04/">四月 2022<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/03/">三月 2022<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/02/">二月 2022<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2022/01/">一月 2022<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/12/">十二月 2021<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/11/">十一月 2021<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/10/">十月 2021<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/09/">九月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/08/">八月 2021<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/07/">七月 2021<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/06/">六月 2021<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/05/">五月 2021<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/04/">四月 2021<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/03/">三月 2021<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/02/">二月 2021<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2021/01/">一月 2021<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/12/">十二月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/11/">十一月 2020<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/10/">十月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/08/">八月 2020<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/07/">七月 2020<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/06/">六月 2020<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/05/">五月 2020<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/04/">四月 2020<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/">博客搭建<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E6%9D%82%E9%A1%B9/">杂项<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B/">算法竞赛<span class="sidebar_archives-count">55</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">课程笔记<span class="sidebar_archives-count">13</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E9%9A%8F%E4%BE%BF%E8%81%8A%E8%81%8A/">随便聊聊<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/">项目总结<span class="sidebar_archives-count">26</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/links" title="友链">
                
                    <i class="material-icons sidebar-material-icons">face</i>
                
                友链
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="关于">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于
            </a>
        </li>
        
    
        <li>
            <a href="/tags" title="标签云">
                
                    <i class="material-icons sidebar-material-icons">cloud_circle</i>
                
                标签云
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

    <a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.help
        <span class="mdl-button__ripple-container">
          <span class="mdl-ripple"></span>
        </span>
      </div>
    </a>

-->

<!-- Feedback -->
<!--

    <a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.feedback
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

<!-- About Theme -->
<!--

    <a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
             sidebar.about_theme
            <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2020&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>Moonglade
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>







    <!-- Busuanzi -->
    <script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



   <!-- GitTalk -->





<!-- UC Browser Compatible -->

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->

<script type="text/ls-javascript" id="Bing-Background-script">
    queue.offer(function(){
        $('body').attr('data-original', 'https://api.i-meto.com/bing?type=T');
    });
</script>


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.2 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
    
</html>
